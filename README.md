# Jenkins Building a Basic End-to-End CI/CD Pipeline for a Maven Project

1. Jenkins can be set up on a Virtual Machine or installed directly on a PC or Mac.
2. SonarQube can be installed directly on the host or within a Docker container.

**Required Plugins:** JDK, SonarQube, OWASP, Docker Related

```bash
# Installing SonarQube
docker run -d -p 9000:9000 sonarqube:lts-community

# Check if the SonarQube container is up and running
docker ps
```

It is crucial to have SonarQube running when executing the below script; otherwise, the build will fail.

## Writing the Build Pipeline

Take a base "Hello World" template:

1. Git checkout.
2. Configure JDK, SonarScanner, Maven. All plugins installed must be configured at Dashboard > Manage Jenkins > Global Tool Configuration.
3. To generate the script:
   - Click on "Pipeline Syntax" in the configure window or go to Dashboard > CI_Pipeline > Pipeline Syntax.
   - Navigate in the page to generate the pipeline script.
   - Select a sample step (e.g., Git) and generate the script.
   - For Docker build, image, and push, generate with the Docker registry Sample Step.

```groovy
pipeline {
    agent any
    
    tools {
        jdk 'jdk11'
        maven 'maven3'
        
    }
    
    environment {
        SCANNER_HOME= tool 'sonar-scanner'
    }

    stages {
        stage('Git Checkout') {
            steps {
               git branch: 'main', url: 'https://github.com/jaiswaladi246/Ekart.git'
            }
        }
        
        stage('Compile Source code') {
            steps {
               sh "mvn clean compile"
            }
        }
        
        stage('Sonarqube Analysis') {
            steps {
                sh '''
                $SCANNER_HOME/bin/sonar-scanner \
                -Dsonar.host.url=http://172.105.17:9000/ \
                -Dsonar.login=squ_9e347cf4e7aacbd54cf6902bac23449b2b49bced \
                -Dsonar.projectName=ekart \
                -Dsonar.java.binaries=. \
                -Dsonar.projectKey=ekart
                '''
            }
        }
        
        stage('OWASP') {
            steps {
               dependencyCheck additionalArguments: ' --scan ./', odcInstallation: 'DP'
               dependencyCheckPublisher pattern: '**/dpendency-check-report.xml'
            }
        }
        
        stage('Build App') {
            steps {
               sh "mvn clean install -DskipTests"
            }
        }
        
        stage('Trigger CD') {
            steps {
               build job: "name of the Cd job", wait: true
            }
        }
    }
}
```

## Creating the Continuous Deployment Pipeline

```groovy
pipeline {
    agent any

    stages {
        stage('Docker Deploy to Container') {
            steps {
                withDockerRegistry (credentialsId: 'credential will be generated by pipeline syntax when we will add auth creds', toolName: 'docker') {
                    sh "docker run -d --name <container name> -p 8070:8070 <image name>"
                }
            }
        }
    }
}
```

If any issues arise regarding credentials, they can always be updated under "Manage Jenkins" > "Credentials."

# Congratulations! Your First Maven CI/CD Pipeline is Ready!
